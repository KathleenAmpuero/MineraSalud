<app-header
  title="Cambiar contraseña"
  [logo]="false"
  [backButton]="closeModal.bind(this)"
></app-header>

<ion-content>
  <div class="flex flex-col h-full p-6">
    <form [formGroup]="form">
      <div class="alert alert-error mb-6" *ngIf="submitMessage">
        <span>{{ submitMessage }}</span>
      </div>

      <fieldset class="fieldset">
        <legend class="fieldset-legend">Contraseña actual</legend>
        <label class="input w-full">
          <input
            formControlName="currentPassword"
            [attr.type]="showCurrentPassword ? 'text' : 'password'"
            placeholder="Tu contraseña actual"
          />
          <button
            type="button"
            class="btn btn-circle btn-sm"
            (click)="showCurrentPassword = !showCurrentPassword"
          >
            @if (showCurrentPassword) {
            <lucide-icon [img]="icons.EyeOffIcon" class="size-4" />
            } @else {
            <lucide-icon [img]="icons.EyeIcon" class="size-4" />
            }
          </button>
        </label>
        <p
          *ngIf="hasError('currentPassword', 'required')"
          class="text-error text-sm mt-1"
        >
          Este campo es obligatorio
        </p>
        <p
          *ngIf="hasError('currentPassword', 'minlength')"
          class="text-error text-sm mt-1"
        >
          Debe tener al menos 6 caracteres
        </p>
      </fieldset>

      <fieldset class="fieldset">
        <legend class="fieldset-legend">Nueva contraseña</legend>
        <label class="input w-full">
          <input
            formControlName="newPassword"
            [attr.type]="showNewPassword ? 'text' : 'password'"
            placeholder="Nueva contraseña"
          />
          <button
            type="button"
            class="btn btn-circle btn-sm"
            (click)="showNewPassword = !showNewPassword"
          >
            @if (showNewPassword) {
            <lucide-icon [img]="icons.EyeOffIcon" class="size-4" />
            } @else {
            <lucide-icon [img]="icons.EyeIcon" class="size-4" />
            }
          </button>
        </label>
        <p
          *ngIf="hasError('newPassword', 'required')"
          class="text-error text-sm mt-1"
        >
          Este campo es obligatorio
        </p>
        <p
          *ngIf="hasError('newPassword', 'minlength')"
          class="text-error text-sm mt-1"
        >
          Debe tener al menos 6 caracteres
        </p>
      </fieldset>

      <fieldset class="fieldset">
        <legend class="fieldset-legend">Confirmar nueva contraseña</legend>
        <label class="input w-full">
          <input
            formControlName="confirmPassword"
            [attr.type]="showConfirmPassword ? 'text' : 'password'"
            placeholder="Confirmar nueva contraseña"
          />
          <button
            type="button"
            class="btn btn-circle btn-sm"
            (click)="showConfirmPassword = !showConfirmPassword"
          >
            @if (showConfirmPassword) {
            <lucide-icon [img]="icons.EyeOffIcon" class="size-4" />
            } @else {
            <lucide-icon [img]="icons.EyeIcon" class="size-4" />
            }
          </button>
        </label>
        <p
          *ngIf="hasError('confirmPassword', 'required')"
          class="text-error text-sm mt-1"
        >
          Este campo es obligatorio
        </p>
        <p *ngIf="passwordMismatch()" class="text-error text-sm mt-1">
          Las contraseñas no coinciden
        </p>
      </fieldset>
    </form>

    <button
      type="submit"
      class="btn btn-primary btn-lg w-full mt-auto"
      (click)="saveChanges()"
      [disabled]="isSubmitting"
    >
      Guardar Cambios
    </button>
  </div>
</ion-content>
